<!DOCTYPE HTML>
<html>
<head>
    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body style = "text-align:center;" id = "body">
Choose JSON file:<br>
<input type="file" id="upload">
<table align = "center"	id="table" border="1"></table>

<script>
    /*		var list = [
                { "col_1": "val_11", "col_3": "val_13" },
                { "col_2": "val_22", "col_3": "val_23" },
                { "col_1": "val_31", "col_3": "val_33" }
            ];*/

    document.getElementById('upload').addEventListener('change', readFileAsString)
    function readFileAsString() {
        var files = this.files;
        if (files.length === 0) {
            console.log('No file is selected');
            return;
        }

        var reader = new FileReader();
        reader.onload = function(event) {
            //console.log(event.target.result);
            //var list = [];
            var list = JSON.parse(event.target.result);
            console.log("calling constructTable");
            constructTable('#table',list);
        };
        reader.readAsText(files[0]);
    }
    function constructTable(selector,list) {

        // Getting the all column names
        var cols = Headers(list, selector);

        // Traversing the JSON data
        for (var i = 0; i < list.length; i++) {
            var row = $('<tr/>');
            for (var colIndex = 0; colIndex < cols.length; colIndex++)
            {
                var val = list[i][cols[colIndex]];//console.log('list['+i+'][cols['+colIndex+']] : ' + val);

                // If there is any key, which is matching
                // with the column name
                if (val == null) val = "";
                row.append($('<td/>').html(val));
            }

            // Adding each row to the table
            $(selector).append(row);
        }
    }

    function Headers(list, selector) {
        var columns = [];
        var header = $('<tr/>');

        for (var i = 0; i < list.length; i++) {
            var row = list[i];

            for (var k in row) {
                if ($.inArray(k, columns) == -1) {
                    columns.push(k);

                    // Creating the header
                    header.append($('<th/>').html(k));
                }
            }
        }

        // Appending the header to the table
        $(selector).append(header); console.log('columns: ' + columns);
        return columns;
    }
</script>
</body>
</html>
